\chapter{Software Implementation} \label{chap:software}
\section{QUANTUM ESPRESSO}
The Quantum opEn  Source  Package  for  Research  in  Electronic  Structure, Simulation, and Optimization (QUANTUM ESPRESSO) is an integrated suite of open source codes for electronic structure calculations and materials modeling based on Density functional theory, plane waves, and pseudopotential approach \citep{Giannozzi2009,Giannozzi2017}. The code is written in FORTRAN which offers an advanced programming with high-performance computing capabilities. The code can take advantage of parallelization that can delegate calculation tasks that leads to substantial decrease in computational time. Quantum ESPRESSO can do several computations including, but not limited to, ground state calculations, structural optimizations, response properties, spectroscopic properties, and quantum transport.
% \subsection{MKL Libraries}
% \subsection{PWSCF routines}
% cbands, cegterg, cdiaghg 
% \section{Intel Compilers}

\section{Parallelization and Executables}
The Quantum Espresso code can take advantage of parallelization in which the calculations are distributed among the processors, technically called as computing cores. Parallelization can speed calculations by several magnitude in comparison to serial computations that are normally done in standard desktop computers. There are two ways to achieve parallelization, either: (1) by distributed memory computing where clusters of multicore processors are interconnected by a fast communication network or (2) by shared memory computing where parallelization takes place inside a single multicore processor. The code follows the parallelization strategy flowchart as shown in  Figure \ref{fig:code_parallel}. The total processors (computing cores) are subdivided into $n_i$ distinct images, each corresponds to a different self-consistent or linear-response calculation, loosely coupled to others. This is only useful if one needs to perform identical simulations repeated $n_i$ times to form an ensemble. Each image is further subdivided $n_k$ pools of k-points, each are independent from one another. Then each k-points are divided into $n_b$ band groups, each taking care of a group of Kohn-Sham orbitals. Lastly, when the number of processors used exceeds the number of fast fourier transform (FFT) points, a parellization  on FFT can be used such that these FFTs acting on Kohn-Sham states are redistributed to $n_t$ task groups so that each group can process several wavefunctions at the same time. A further level of parallelization can be applied on matrix diagonalization where the diagonalization is  performed in parallel using standard linear algebra operations such as Linear Algebra Package (LAPACK) and Basic Linear Algebra Subprograms (BLAS) algorithms.

The core subprogram of Quantum Espresso is the Plane-Wave Self-Consistent Field (PWSCF) package  used for scf and non-scf calculations. It includes other specialized packages such as PostProc (PP) package which contains various utilities for data postprocessing. The  bands.x program will create a band structure diagram based on the results of scf calculation while dos.x and projwfc.x programs will generate density of states and projected density of states, respectively.

\begin{figure}[tbh!]
	\centering
	\includegraphics[width=0.48\linewidth]{"images/parallelization"}
	\caption[Code parallelization strategy used in Quantum Espresso]{Code parallelization strategy used in Quantum Espresso}
	\label{fig:code_parallel}
\end{figure}



\section{Computational Details}
This section outlines the computational recipes of successfully simulating material properties using Density Functional Theory executed within  Quantum Espresso code version 6.5. All the simulations were ran in Computing and Archiving Research Environment (COARE) facility under DOST Advanced Science and Technology Institue (ASTI).

\subsection{Pseudopotential}
This thesis used the Garrity-Bennett-Rabe-Vanderbilt (GBRV) ultrasoft pseudopotential library that was designed at Rutgers university \citep{Garrity2014}. The pseudopotential was generated using GGA exchangeâ€“correlation correlation functional based on Perdew-Burke-Ernzerhof (PBE) functional \citep{Perdew1996}. For the $\ch{Zn}$ atom, the pseudopotential included 3s, 3p, 3d, 4s orbitals for valence calculations  while the inner core orbitals were approximated using an ultrasoft pseudopotential. The 3s and 3p orbitals are considered as "semi-core" orbitals since they do not participate on chemical bonding but were included only in electronic structure calculations. For the O atom, only  2s and 2p orbitals were taken into account. Thus, Zn has 20 valence electrons while O has 6 valence electrons.

\subsection{Convergence Testing}
The optimum values of the k-points, and kinetic energy-cutoffs  of  Kohn-Sham orbitals and electron density to be used in subsequent calculations were determine from convergence tests. Initially, k-points were varied for a fixed plane wave cutoff energy and electron density cutoff energy. These fixed values were set at $E_{\text{wfc}} = 40$ Ry and $E_{\text{rho}} = 320$ Ry, which are the suggested minimum values set by the pseudopotential used \citep{Garrity2014}.  Since the c-axis of \ch{ZnO} unit cell is longer, as shown in Figure \ref{fig:ZnO_unit}, its corresponding reciprocal lattice is smaller. Hence, the grid points in the $k_z$ direction were scaled down properly. The Monkhorst-Pack grid centered at $\Gamma$ point was set at $(k+5) \times (k +5 ) \times k$. After finding the optimum k-point, the energy cutoff $E_{\text{wfc}}$ of the Kohn-Sham orbital was varied. The energy cutoff of the electron density $E_{\text{rho}}$ was maintained at $8 \times E_{\text{wfc}}$, where dual $=8$ is a multiplier of $E_{\text{wfc}}$. Lastly, the $E_{\text{rho}}$ was varied by changing its dual with respect to the optimized k-point $k$ and plane wave cutoff energy $E_{\text{wfc}}$ until desired material properties did not change. The material properties investigated in the convergence tests were total energy and thermodynamic pressure since both are sensitive to the parameters given above.

\subsection{Supercell construction}
The supercell is generated from the stacking of wurtzite \ch{ZnO} unit cell as  shown in Figure \ref{fig:ZnO_unit}a. The structural parameters of wurtzite ZnO unit cell were set at $a=3.2427 $ {\AA} and $c = 5.1948 $ {\AA} as obtained by Sabine and Hogg \citep{Sabine1969}  using X-ray crystallography technique and will be served as the reference structural data in this thesis. A $3 \times 3 \times 2$ supercell was constructed  in terms of the four distinct atoms in the unit cell as represented in Figure \ref{fig:zno_supercell}. Thus, the supercell consists in total of 72 atoms with periodic boundary conditions. Vacancies were simulated by removing an atom from the crystal lattice while interstitials were simulated by adding atoms in the voids of the crystal lattice. Antisites, where O atom is replaced by Zn atom and vice versa, were also modeled. Lastly, charged defects were modeled by removing one or two electrons from the crystal system. Since the volume of supercell is larger than its unit cell, the resulting supercell in the reciprocal space is much smaller. Hence, the k-points were scaled down to $2 \times 2 \times 2$ Monkhorst-Pack grid.

\begin{figure}[tbh!]
	\centering
	\includegraphics[width=0.6\linewidth]{"images/rnd/ZnO_supercell"}
	\caption[The $3 \times 3 \times 2$ supercell used in this study]{The $3 \times 3 \times 2$ supercell used in this study. The solid lines enclosed the wurtzite ZnO unit cell. }
	\label{fig:zno_supercell}
\end{figure}


\subsection{Hubbard correction parameters}
Hubbard-U correction was applied to treat the strong correlation of the 2p and 3d states present in \ch{ZnO}. Specifically, the U parameter of 2p and 3d orbitals, denoted as $U_{p}$ and $U_{d}$, were empirically tuned until the calculated band gap matches the experimental band gap. The obtained value will be used throughout the course of simulation.  The Hubbard term $U_d$ was varied from 11 eV to 19 eV with an increment of 2 eV while $U_p$ was varied from 5 eV to 10 eV with an increment of 0.5 eV.

\subsection{Structural relaxation}
The positions of the atoms in the unit cell of ZnO was based on experimental measurements \citep{Sabine1969}.  To accurately describe the system, the forces must be negligible. The geometry of the system was optimized by relaxing all atomic positions within the supercell subject to the following criteria: the total energy changes by less than the threshold of $1 \times 10^{-5}$ Ry between two consecutive scf steps, and the total force is less than the force threshold of $1 \times 10^{-4}$ Ry/bohr. The crystal  geometries are optimized with the direct energy minimization technique of Broyden-Fletcher-Goldfarb-Shanno (BFGS) quasi-newton algorithm \citep{Broyden1970,Fletcher1970,Goldfarb1970,Shanno1970}.

\subsection{SCF calculation}
Since the optimum values of k-points and cutoff energies were determined from the convergence tests, the main program of Quantum Espresso which is the self-consistent field calculation can proceed smoothly. The flow diagram of the SCF calculation together with the structural relaxation is shown in Figure \ref{fig:ionic_relax}. The convergence threshold for the scf calculation was set at $1 \times 10^{-6}$ Ry. If the change in electron density was below this threshold, the electron density is the ground state density and pertinent properties such as total energy can be calculated. Broyden charge density mixing \citep{Broyden1965} was used as a mixing mode to update the charge density with  $\alpha = 0.4$ as the mixing parameter.   The occupations were smoothed by a gaussian smearing with a broadening factor of 0.001 Ry.

\subsection{Formation Energies}
The defect formation energies were calculated according to Eq. \eqref{eq:formation_E}. In all total energy calculations, geometric relaxations were done first since defect transition levels are affected by the atomic positions. The pertinent total energies were calculated based on the computational parameters and thresholds introduced in scf calculation. The chemical potential of \ch{Zn} atom at the standard phase $\mu_{\ch{Zn}}(\text{metal})$ was calculated from the total energy of a Zn hcp solid. The chemical potential of \ch{O} atom at the standard phase
$\mu_{\ch{O}}(\ch{O2})$ was calculated from  half the total energy of an isolated \ch{O2} molecule. The chemical potential of $\mu_{\ch{ZnO}}$ was taken to be the total energy of an unit cell. Absolute energy was used for the valence band maximum $E_{\text{vbm}}$. However, the Fermi level $E_f$ was shifted so that its zero coincides with the valence band maximum.

\subsection{Bandstructure calculation}
After scf calculation, the total energy and electron density were in the ground state. However, to visualize the band gap, selected k-points along the high symmetry points must be used instead of the uniform Monkhorst-Pack grid. For a fixed potential obtained from scf calculation, the banstructure calculation proceeded by calculating the Kohn-Sham states along the high symmetry points given by the path $\Gamma-A-H-K-\Gamma-M-L-H$. The fermi level $E_f$ is set deliberately at the valence band maximum (VBM) and the energies are shifted so that $E_f$ is at  0 Ry.

\subsection{DOS calculation}
For density of states (DOS) calculation, a denser k-point mesh grid was used to properly described the contribution of each orbitals to a  specific energy range. A $12 \times 12 \times 12$ Monkhorst-Pack grid was used for DOS calculation. The smearing used was linear tetrahedron method since it is the preferred smearing for DOS calculations. The partial density of states (PDOS) was calculated the same way as the  DOS calculation. Since the resulting plots contained a lot of numerical noise, a Savitzky-Golay filter was applied to smooth out the noisy signal by fitting a polynomial of varying degree \citep{Savitzky1964,Luo2005}.

